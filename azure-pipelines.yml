trigger:
  branches:
    include:
    - main


pool:
  name: Default

steps:
- script: |
    curl https://sh.rustup.rs -sSf | sh -s -- -y
    source $HOME/.cargo/env
    rustup default stable
    rustup update
    cargo install trunk
  displayName: 'Install Rust and trunk'

- script: |
    source $HOME/.cargo/env
    trunk build --release
  displayName: 'Build the project with trunk'


- script: |
    git config user.name "Jonathan Larios"
    git config user.email "jonathan@linearosa.app"
    git checkout -b gh-pages
    cp -r dist/* .
    git add .
    git commit -m "Deploy to GitHub Pages"
    git push -f origin gh-pages
  displayName: 'Deploy to GitHub Pages'